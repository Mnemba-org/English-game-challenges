<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Narrative Listening Quiz Game</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 700px;
    margin: 30px auto;
    padding: 20px;
    background: #f0f4f8;
    color: #333;
  }
  h2 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 15px;
  }
  #score-timer {
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
    font-size: 1.1rem;
  }
  #status {
    margin: 10px 0 15px 0;
    font-style: italic;
    font-weight: 600;
    text-align: center;
    min-height: 24px;
  }
  #options {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  button.option-btn {
    padding: 12px;
    font-size: 1rem;
    border-radius: 8px;
    border: 2px solid #3498db;
    background: white;
    cursor: pointer;
    transition: background-color 0.3s, border-color 0.3s;
  }
  button.option-btn:hover:not(:disabled) {
    background-color: #ecf0f1;
  }
  button.option-btn.correct {
    border-color: green;
    background-color: #d4edda;
    cursor: default;
  }
  button.option-btn.wrong {
    border-color: red;
    background-color: #f8d7da;
    cursor: default;
  }
  #controls {
    margin-top: 20px;
    text-align: center;
  }
  #play-btn, #next-btn {
    font-size: 1rem;
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    background-color: #3498db;
    color: white;
    cursor: pointer;
    margin: 0 10px;
    transition: background-color 0.3s;
  }
  #play-btn:disabled, #next-btn:disabled {
    background-color: #a0bcd9;
    cursor: default;
  }
  #next-btn {
    display: none;
  }
  #back-btn {
    display: block;
    margin: 30px auto 0;
    padding: 10px 20px;
    background-color: #e74c3c;
    color: white;
    font-size: 1rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2>Narrative Listening Quiz Game</h2>
<div id="score-timer">Question <span id="q-num">1</span>/10 &nbsp;&nbsp;|&nbsp;&nbsp; Score: <span id="score">0</span></div>
<div id="status">Click "Play Narrative" to listen.</div>

<div id="options"></div>

<div id="controls">
  <button id="play-btn">Play Narrative</button>
  <button id="next-btn">Next Question</button>
</div>

<button id="back-btn">üè† Back to Challenges</button>

<script>
  const narratives = [
    {
      text: `Last Saturday, I went to the park early in the morning...`,
      options: [
        "A visit to a busy market",
        "A relaxing day at the park",
        "A trip to the beach",
        "A rainy day indoors"
      ],
      correctAnswer: "A relaxing day at the park"
    },
    {
      text: `My friend recently got a new puppy...`,
      options: [
        "A story about a new pet puppy",
        "How to train a dog",
        "Visiting a zoo with animals",
        "A lost puppy finding home"
      ],
      correctAnswer: "A story about a new pet puppy"
    },
    {
      text: `During the summer holidays, I traveled to the mountains...`,
      options: [
        "A winter ski trip",
        "Camping in the mountains during summer",
        "A day at the amusement park",
        "Fishing in the river"
      ],
      correctAnswer: "Camping in the mountains during summer"
    }
    // Add more questions as needed
  ];

  let currentQuestion = 0;
  let score = 0;
  let gameOver = false;
  let utterance;
  const speechSynth = window.speechSynthesis;

  const qNumSpan = document.getElementById("q-num");
  const scoreSpan = document.getElementById("score");
  const statusDiv = document.getElementById("status");
  const optionsDiv = document.getElementById("options");
  const playBtn = document.getElementById("play-btn");
  const nextBtn = document.getElementById("next-btn");

  function shuffle(array) {
    for(let i = array.length -1; i > 0; i--){
      const j = Math.floor(Math.random() * (i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function loadQuestion(){
    statusDiv.textContent = "Click \"Play Narrative\" to listen.";
    qNumSpan.textContent = currentQuestion + 1;
    scoreSpan.textContent = score;
    optionsDiv.innerHTML = "";
    nextBtn.style.display = "none";
    playBtn.disabled = false;
    gameOver = false;

    const shuffledOptions = shuffle([...narratives[currentQuestion].options]);

    shuffledOptions.forEach(option => {
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.textContent = option;
      btn.disabled = true;
      btn.onclick = () => selectAnswer(btn, option);
      optionsDiv.appendChild(btn);
    });
  }

  function playNarrative(){
    if(speechSynth.speaking){
      speechSynth.cancel();
    }
    playBtn.disabled = true;
    statusDiv.textContent = "Listening...";

    utterance = new SpeechSynthesisUtterance(narratives[currentQuestion].text);
    utterance.lang = "en-US";
    utterance.rate = 1;

    utterance.onend = () => {
      statusDiv.textContent = "Choose the correct answer:";
      [...optionsDiv.children].forEach(btn => btn.disabled = false);
      playBtn.disabled = false;
    };

    speechSynth.speak(utterance);
  }

  function selectAnswer(button, selectedOption){
    [...optionsDiv.children].forEach(btn => btn.disabled = true);
    playBtn.disabled = true;

    const correct = narratives[currentQuestion].correctAnswer;

    if(selectedOption === correct){
      button.classList.add("correct");
      score++;
      statusDiv.textContent = "Correct!";
    } else {
      button.classList.add("wrong");
      statusDiv.textContent = `Wrong! Correct answer: "${correct}".`;
      [...optionsDiv.children].forEach(btn => {
        if(btn.textContent === correct){
          btn.classList.add("correct");
        }
      });
    }
    scoreSpan.textContent = score;
    nextBtn.style.display = "inline-block";
  }

  function nextQuestion(){
    currentQuestion++;
    if(currentQuestion >= narratives.length){
      statusDiv.textContent = `Game Over! Your final score is ${score} out of ${narratives.length}. Thanks for playing!`;
      optionsDiv.innerHTML = "";
      playBtn.style.display = "none";
      nextBtn.style.display = "none";
      qNumSpan.textContent = narratives.length;
      gameOver = true;
    } else {
      loadQuestion();
    }
  }

  playBtn.addEventListener("click", playNarrative);
  nextBtn.addEventListener("click", nextQuestion);

  // Handle "Back to Challenges" button
  document.getElementById("back-btn").addEventListener("click", function () {
    if (!gameOver) {
      alert("You are still playing. Are you sure you want to leave?");
    }
    window.location.href = "challenges.html";
  });

  loadQuestion();
</script>

</body>
</html>
